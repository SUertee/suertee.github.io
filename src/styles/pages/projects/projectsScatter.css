@layer components {
  /* Scatter stage and folder: sets the play space and initial folder motif.
     Reason: keeps the scatter view contained and hints at card origin. */
  .scatter-stage {
    position: relative;
    height: 420px;
    margin-top: 1.25rem;
    cursor: pointer;
    opacity: 0;
    transform: translateY(16px) scale(0.98);
    transition: opacity 350ms ease, transform 450ms cubic-bezier(0.19, 1, 0.22, 1);
  }

  .scatter-stage.is-ready {
    opacity: 1;
    transform: translateY(0) scale(1);
  }

  .folder-stack {
    position: absolute;
    inset: 0;
    display: grid;
    place-items: center;
    opacity: 1;
    transition: opacity 200ms ease, transform 200ms ease;
    pointer-events: none;
    transform: translateY(-20px) scale(var(--folder-scale));
  }

  .folder-stack.is-open {
    opacity: 0.1;
  }

  .folder-backdrop {
    position: absolute;
    width: 270px;
    height: 140px;
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.1), transparent);
    border-radius: 1rem;
    border: none;
    filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.4));
  }

  .folder-tab {
    position: absolute;
    top: calc(50% - 88px);
    width: 120px;
    height: 22px;
    border-radius: 14px 14px 6px 6px;
    background: linear-gradient(90deg, rgba(129, 140, 248, 0.45), rgba(52, 211, 153, 0.35));
  }

  .folder-cover {
    position: absolute;
    top: calc(50% - 52px);
    width: 260px;
    height: 100px;
    border-radius: 14px;
    background: linear-gradient(145deg, rgba(24, 31, 55, 0.95), rgba(10, 12, 23, 0.95));
    border: 1px solid rgba(255, 255, 255, 0.08);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.6rem;
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.45);
  }

  .folder-dot {
    width: 10px;
    height: 10px;
    border-radius: 9999px;
    background: radial-gradient(circle, #22d3ee, #6366f1);
    box-shadow: 0 0 18px rgba(99, 102, 241, 0.7);
  }

  /* Scatter card styling (shared visual language with timeline) */
  .scatter-card {
    position: absolute;
    left: 50%;
    top: 45%;
    width: clamp(200px, 82vw, 320px);
    border-radius: 1.05rem;
    padding: 1.1rem 1.05rem;
    border: 1px solid rgba(255, 255, 255, 0.08);
    transform: var(--card-transform, translate(-50%, -50%));
    background: linear-gradient(
        140deg,
        rgba(255, 255, 255, 0.06),
        rgba(255, 255, 255, 0)
      ),
      linear-gradient(180deg, rgba(8, 8, 12, 0.92), rgba(15, 23, 42, 0.85));
    color: #e5e7eb;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.55);
    transition:
      transform 420ms cubic-bezier(0.2, 0.8, 0.2, 1),
      box-shadow 220ms ease,
      border-color 220ms ease,
      filter 220ms ease;
    cursor: grab;
    animation: none;
  }

  .scatter-card.is-active {
    border-color: color-mix(in oklab, var(--project-accent, #8b5cf6) 60%, #ffffff 10%);
    filter: drop-shadow(0 12px 35px rgba(0, 0, 0, 0.5));
    transform: var(--card-transform) scale(1.05);
    z-index: 120 !important;
    animation: project-pop 380ms cubic-bezier(0.22, 1, 0.36, 1);
  }

  .scatter-card:hover {
    z-index: 200 !important;
    filter: drop-shadow(0 14px 45px rgba(0, 0, 0, 0.55));
    transform: var(--card-transform) scale(1.04);
    border-color: color-mix(in oklab, var(--project-accent, #8b5cf6) 40%, #ffffff 8%);
    cursor: grabbing;
  }

  .scatter-card-top {
    @apply flex items-center gap-2 text-sm;
  }

  .scatter-dot {
    width: 8px;
    height: 8px;
    border-radius: 9999px;
    background: var(--project-accent, #8b5cf6);
    box-shadow: 0 0 10px var(--project-accent, #8b5cf6);
  }

  .scatter-title {
    @apply font-semibold text-white;
  }

  .scatter-period {
    @apply ml-auto text-[11px] uppercase tracking-wider text-neutral-400;
  }

  .scatter-role {
    @apply mt-1 text-xs text-indigo-200;
  }

  .scatter-tags {
    @apply mt-2 flex flex-wrap gap-1;
  }

  .scatter-tag {
    @apply rounded-full bg-white/5 px-2 py-0.5 text-[11px] text-neutral-200;
    border: 1px solid rgba(255, 255, 255, 0.06);
  }

  @keyframes scatter-deal {
    0% {
      opacity: 0;
      transform: translate(calc(-50% + var(--deal-offset, 0px)), 40%)
        scale(0.64) rotate(-10deg);
      filter: blur(6px);
    }
    60% {
      opacity: 1;
      transform: translate(calc(-50% + var(--deal-offset, 0px)), -8%)
        scale(0.98) rotate(1deg);
      filter: blur(1px);
    }
    100% {
      opacity: 1;
      transform: var(--card-transform);
      filter: blur(0);
    }
  }
}
